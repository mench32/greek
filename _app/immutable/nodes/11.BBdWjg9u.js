import{s as p,e as A,c as L,b as E,f as m,i as T,G as D,I as K,D as q,o as C,k as P,n as V}from"../chunks/scheduler.BX8YVY3S.js";import{S as x,i as k,c as H,a as S,m as M,t as d,b as h,e as I,d as G,g as R}from"../chunks/index.CpUgF7Al.js";import{b as _}from"../chunks/paths.DzIDqDJR.js";import{p as b}from"../chunks/audio.DeAYY8kc.js";import{H as z,A as j,D as B}from"../chunks/common.consts.D84wbaSv.js";import{s as F}from"../chunks/settings.CR0N8Coa.js";function J(s){let t,n,r;return n=new z({props:{text:s[1],words:s[0]}}),{c(){t=A("div"),H(n.$$.fragment)},l(e){t=L(e,"DIV",{});var o=E(t);S(n.$$.fragment,o),o.forEach(m)},m(e,o){T(e,t,o),M(n,t,null),s[4](t),r=!0},p(e,[o]){const i={};o&2&&(i.text=e[1]),o&1&&(i.words=e[0]),n.$set(i)},i(e){r||(d(n.$$.fragment,e),r=!0)},o(e){h(n.$$.fragment,e),r=!1},d(e){e&&m(t),I(n),s[4](null)}}}function N(s){if(s&&s instanceof HTMLElement){const t=s.getAttribute("data-placeholder")??"";Math.max(3,t.length)}}function w(s){s.target instanceof HTMLElement&&(s.target.querySelectorAll("br").forEach(t=>t.remove()),(s.target.querySelectorAll("br").length||s.target.innerText.trim()!==s.target.innerHTML.trim())&&(s.target.innerHTML=s.target.innerText))}function O(s,t,n){let{storageKey:r}=t,{words:e=[]}=t,{text:o}=t,i;D(()=>{i.querySelectorAll(".answer").forEach(a=>{if(a instanceof HTMLElement){const g=a.getAttribute("data-answer"),f=a.getAttribute("data-placeholder"),u=localStorage.getItem(`${r}_${f}`)||null;a.innerText=u??f??"",u&&typeof u=="string"?u!==g&&(a.classList.add("error"),a.setAttribute("contenteditable","true")):a.setAttribute("contenteditable","true"),N(a)}}),i.addEventListener("input",w),i.addEventListener("keypress",l)}),K(()=>{i.removeEventListener("input",w),i.removeEventListener("keypress",l)});function l(a){if(a.target instanceof HTMLElement){const g=a.target.innerText;if(a.target.querySelectorAll("br").forEach(f=>f.remove()),(a.target.querySelectorAll("br").length||g.trim()!==a.target.innerHTML.trim())&&(a.target.innerHTML=g),a.key==="Enter"){const f=a.target.getAttribute("data-answer"),u=g.trim().toLowerCase();u||(a.target.innerText=a.target.getAttribute("data-placeholder")??""),u===f?(a.target.classList.remove("error"),a.target.removeAttribute("contenteditable"),b(`${_}/success.mp3`)):(a.target.classList.add("error"),b(`${_}/error.mp3`)),localStorage.setItem(`${r}_${a.target.getAttribute("data-placeholder")}`,u)}}}function c(a){q[a?"unshift":"push"](()=>{i=a,n(2,i)})}return s.$$set=a=>{"storageKey"in a&&n(3,r=a.storageKey),"words"in a&&n(0,e=a.words),"text"in a&&n(1,o=a.text)},[e,o,i,r,c]}class Q extends x{constructor(t){super(),k(this,t,O,J,p,{storageKey:3,words:0,text:1})}}function y(s){let t,n;return t=new Q({props:{storageKey:s[0].lesson+"_"+s[0].exercise.position,text:s[2],words:s[1]}}),{c(){H(t.$$.fragment)},l(r){S(t.$$.fragment,r)},m(r,e){M(t,r,e),n=!0},p(r,e){const o={};e&1&&(o.storageKey=r[0].lesson+"_"+r[0].exercise.position),e&4&&(o.text=r[2]),e&2&&(o.words=r[1]),t.$set(o)},i(r){n||(d(t.$$.fragment,r),n=!0)},o(r){h(t.$$.fragment,r),n=!1},d(r){I(t,r)}}}function U(s){let t,n=s[2],r,e=y(s);return{c(){t=A("div"),e.c(),this.h()},l(o){t=L(o,"DIV",{class:!0});var i=E(t);e.l(i),i.forEach(m),this.h()},h(){C(t,"class","md")},m(o,i){T(o,t,i),e.m(t,null),r=!0},p(o,[i]){i&4&&p(n,n=o[2])?(R(),h(e,1,1,V),G(),e=y(o),e.c(),d(e,1),e.m(t,null)):e.p(o,i)},i(o){r||(d(e),r=!0)},o(o){h(e),r=!1},d(o){o&&m(t),e.d(o)}}}function W(s,t,n){let r;P(s,F,c=>n(4,r=c));let{data:e}=t,o=[],i="",l=[];return s.$$set=c=>{"data"in c&&n(0,e=c.data)},s.$$.update=()=>{s.$$.dirty&1&&(n(3,o=e.dict.map(c=>({word:c.origin.trim().replace(/(\sη$)|(\sο$)|(\sτο$)/,""),title:c.translate,whole:!0}))),n(2,i=e.exercise.text??"")),s.$$.dirty&26&&(n(1,l=[]),r.showTranslates&&l.push(["color: steelblue;",o]),r.showArticles&&l.push(["color: coral;",j]),r.showDigraphs&&l.push(["text-decoration: underline;",B]),n(1,l),n(4,r),n(3,o),n(0,e))},[e,l,i,o,r]}class te extends x{constructor(t){super(),k(this,t,W,U,p,{data:0})}}export{te as component};
