import{s as p,e as A,c as L,b as E,f as m,i as T,F as x,I as K,D as q,o as C,k as P,n as V}from"../chunks/scheduler.BbuH-vNs.js";import{S as H,i as k,c as S,a as M,m as I,t as d,b as h,e as D,d as R,g as z}from"../chunks/index.CsIem04_.js";import{b as _}from"../chunks/paths.BF_DaI3d.js";import{p as b}from"../chunks/audio.DeAYY8kc.js";import{H as F,A as G,D as j}from"../chunks/common.consts.DTWA9DkA.js";import{s as B}from"../chunks/settings.uyLFyfV0.js";function J(s){let t,n,a;return n=new F({props:{text:s[1],words:s[0]}}),{c(){t=A("div"),S(n.$$.fragment)},l(r){t=L(r,"DIV",{});var o=E(t);M(n.$$.fragment,o),o.forEach(m)},m(r,o){T(r,t,o),I(n,t,null),s[4](t),a=!0},p(r,[o]){const i={};o&2&&(i.text=r[1]),o&1&&(i.words=r[0]),n.$set(i)},i(r){a||(d(n.$$.fragment,r),a=!0)},o(r){h(n.$$.fragment,r),a=!1},d(r){r&&m(t),D(n),s[4](null)}}}function N(s){if(s&&s instanceof HTMLElement){const t=s.getAttribute("data-placeholder")??"";Math.max(3,t.length)}}function w(s){s.target instanceof HTMLElement&&(s.target.querySelectorAll("br").forEach(t=>t.remove()),(s.target.querySelectorAll("br").length||s.target.innerText.trim()!==s.target.innerHTML.trim())&&(s.target.innerHTML=s.target.innerText))}function O(s,t,n){let{storageKey:a}=t,{words:r=[]}=t,{text:o}=t,i;x(()=>{i.querySelectorAll(".answer").forEach(e=>{if(e instanceof HTMLElement){const f=e.getAttribute("data-answer"),c=e.getAttribute("data-placeholder"),u=localStorage.getItem(`${a}_${c}`)||null;e.innerText=u??c??"",u&&typeof u=="string"?u!==f&&(e.classList.add("error"),e.setAttribute("contenteditable","true")):e.setAttribute("contenteditable","true"),N(e)}}),i.addEventListener("input",w),i.addEventListener("keypress",l)}),K(()=>{i.removeEventListener("input",w),i.removeEventListener("keypress",l)});function l(e){if(e.target instanceof HTMLElement){const f=e.target.innerText;if(e.target.querySelectorAll("br").forEach(c=>c.remove()),(e.target.querySelectorAll("br").length||f.trim()!==e.target.innerHTML.trim())&&(e.target.innerHTML=f),e.key==="Enter"){const c=e.target.getAttribute("data-answer"),u=f.trim();u||(e.target.innerText=e.target.getAttribute("data-placeholder")??""),c&&u.toLowerCase()===c.toLowerCase()?(e.target.classList.remove("error"),e.target.removeAttribute("contenteditable"),b(`${_}/success.mp3`)):(e.target.classList.add("error"),b(`${_}/error.mp3`))}localStorage.setItem(`${a}_${e.target.getAttribute("data-placeholder")}`,f.trim())}}function g(e){q[e?"unshift":"push"](()=>{i=e,n(2,i)})}return s.$$set=e=>{"storageKey"in e&&n(3,a=e.storageKey),"words"in e&&n(0,r=e.words),"text"in e&&n(1,o=e.text)},[r,o,i,a,g]}class Q extends H{constructor(t){super(),k(this,t,O,J,p,{storageKey:3,words:0,text:1})}}function y(s){let t,n;return t=new Q({props:{storageKey:s[0].lesson+"_"+s[0].exercise.position,text:s[1],words:s[2]}}),{c(){S(t.$$.fragment)},l(a){M(t.$$.fragment,a)},m(a,r){I(t,a,r),n=!0},p(a,r){const o={};r&1&&(o.storageKey=a[0].lesson+"_"+a[0].exercise.position),r&2&&(o.text=a[1]),r&4&&(o.words=a[2]),t.$set(o)},i(a){n||(d(t.$$.fragment,a),n=!0)},o(a){h(t.$$.fragment,a),n=!1},d(a){D(t,a)}}}function U(s){let t,n=s[1],a,r=y(s);return{c(){t=A("div"),r.c(),this.h()},l(o){t=L(o,"DIV",{class:!0});var i=E(t);r.l(i),i.forEach(m),this.h()},h(){C(t,"class","md")},m(o,i){T(o,t,i),r.m(t,null),a=!0},p(o,[i]){i&2&&p(n,n=o[1])?(z(),h(r,1,1,V),R(),r=y(o),r.c(),d(r,1),r.m(t,null)):r.p(o,i)},i(o){a||(d(r),a=!0)},o(o){h(r),a=!1},d(o){o&&m(t),r.d(o)}}}function W(s,t,n){let a;P(s,B,e=>n(3,a=e));let{data:r}=t,o=[],i="",l=[];x(()=>{g(a)});function g(e){n(2,l=[]),e.showTranslates&&l.push(["color: steelblue;",o]),e.showArticles&&l.push(["color: coral;",G]),e.showDigraphs&&l.push(["text-decoration: underline;",j]),n(2,l)}return s.$$set=e=>{"data"in e&&n(0,r=e.data)},s.$$.update=()=>{s.$$.dirty&1&&(o=r.dict.map(e=>({word:e.origin.trim().replace(/(\sη$)|(\sο$)|(\sτο$)/,""),title:e.translate,whole:!0})),n(1,i=r.exercise.text??"")),s.$$.dirty&8&&g(a)},[r,i,l,a]}class te extends H{constructor(t){super(),k(this,t,W,U,p,{data:0})}}export{te as component};
