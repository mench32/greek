import{s as p,e as A,c as L,b as E,f as m,i as T,F as x,I as K,D as q,o as C,k as P,n as V}from"../chunks/scheduler.BbuH-vNs.js";import{S as H,i as k,c as S,a as M,m as I,t as d,b as h,e as D,d as R,g as z}from"../chunks/index.CsIem04_.js";import{b as _}from"../chunks/paths.CyTDQK6q.js";import{p as b}from"../chunks/audio.DeAYY8kc.js";import{H as F,A as G,D as j}from"../chunks/common.consts.DTWA9DkA.js";import{s as B}from"../chunks/settings.uyLFyfV0.js";function J(s){let t,o,a;return o=new F({props:{text:s[1],words:s[0]}}),{c(){t=A("div"),S(o.$$.fragment)},l(r){t=L(r,"DIV",{});var n=E(t);M(o.$$.fragment,n),n.forEach(m)},m(r,n){T(r,t,n),I(o,t,null),s[4](t),a=!0},p(r,[n]){const i={};n&2&&(i.text=r[1]),n&1&&(i.words=r[0]),o.$set(i)},i(r){a||(d(o.$$.fragment,r),a=!0)},o(r){h(o.$$.fragment,r),a=!1},d(r){r&&m(t),D(o),s[4](null)}}}function N(s){if(s&&s instanceof HTMLElement){const t=s.getAttribute("data-placeholder")??"";Math.max(3,t.length)}}function w(s){s.target instanceof HTMLElement&&(s.target.querySelectorAll("br").forEach(t=>t.remove()),(s.target.querySelectorAll("br").length||s.target.innerText.trim()!==s.target.innerHTML.trim())&&(s.target.innerHTML=s.target.innerText))}function O(s,t,o){let{storageKey:a}=t,{words:r=[]}=t,{text:n}=t,i;x(()=>{i.querySelectorAll(".answer").forEach(e=>{if(e instanceof HTMLElement){const f=e.getAttribute("data-answer"),u=e.getAttribute("data-placeholder"),c=localStorage.getItem(`${a}_${u}`)||null;e.innerText=c??u??"",c&&typeof c=="string"?c!==f&&(e.classList.add("error"),e.setAttribute("contenteditable","true")):e.setAttribute("contenteditable","true"),N(e)}}),i.addEventListener("input",w),i.addEventListener("keypress",l)}),K(()=>{i.removeEventListener("input",w),i.removeEventListener("keypress",l)});function l(e){if(e.target instanceof HTMLElement){const f=e.target.innerText;if(e.target.querySelectorAll("br").forEach(u=>u.remove()),(e.target.querySelectorAll("br").length||f.trim()!==e.target.innerHTML.trim())&&(e.target.innerHTML=f),e.key==="Enter"){const u=e.target.getAttribute("data-answer"),c=f.trim().toLowerCase();c||(e.target.innerText=e.target.getAttribute("data-placeholder")??""),c===u?(e.target.classList.remove("error"),e.target.removeAttribute("contenteditable"),b(`${_}/success.mp3`)):(e.target.classList.add("error"),b(`${_}/error.mp3`)),localStorage.setItem(`${a}_${e.target.getAttribute("data-placeholder")}`,c)}}}function g(e){q[e?"unshift":"push"](()=>{i=e,o(2,i)})}return s.$$set=e=>{"storageKey"in e&&o(3,a=e.storageKey),"words"in e&&o(0,r=e.words),"text"in e&&o(1,n=e.text)},[r,n,i,a,g]}class Q extends H{constructor(t){super(),k(this,t,O,J,p,{storageKey:3,words:0,text:1})}}function y(s){let t,o;return t=new Q({props:{storageKey:s[0].lesson+"_"+s[0].exercise.position,text:s[1],words:s[2]}}),{c(){S(t.$$.fragment)},l(a){M(t.$$.fragment,a)},m(a,r){I(t,a,r),o=!0},p(a,r){const n={};r&1&&(n.storageKey=a[0].lesson+"_"+a[0].exercise.position),r&2&&(n.text=a[1]),r&4&&(n.words=a[2]),t.$set(n)},i(a){o||(d(t.$$.fragment,a),o=!0)},o(a){h(t.$$.fragment,a),o=!1},d(a){D(t,a)}}}function U(s){let t,o=s[1],a,r=y(s);return{c(){t=A("div"),r.c(),this.h()},l(n){t=L(n,"DIV",{class:!0});var i=E(t);r.l(i),i.forEach(m),this.h()},h(){C(t,"class","md")},m(n,i){T(n,t,i),r.m(t,null),a=!0},p(n,[i]){i&2&&p(o,o=n[1])?(z(),h(r,1,1,V),R(),r=y(n),r.c(),d(r,1),r.m(t,null)):r.p(n,i)},i(n){a||(d(r),a=!0)},o(n){h(r),a=!1},d(n){n&&m(t),r.d(n)}}}function W(s,t,o){let a;P(s,B,e=>o(3,a=e));let{data:r}=t,n=[],i="",l=[];x(()=>{g(a)});function g(e){o(2,l=[]),e.showTranslates&&l.push(["color: steelblue;",n]),e.showArticles&&l.push(["color: coral;",G]),e.showDigraphs&&l.push(["text-decoration: underline;",j]),o(2,l)}return s.$$set=e=>{"data"in e&&o(0,r=e.data)},s.$$.update=()=>{s.$$.dirty&1&&(n=r.dict.map(e=>({word:e.origin.trim().replace(/(\sη$)|(\sο$)|(\sτο$)/,""),title:e.translate,whole:!0})),o(1,i=r.exercise.text??"")),s.$$.dirty&8&&g(a)},[r,i,l,a]}class te extends H{constructor(t){super(),k(this,t,W,U,p,{data:0})}}export{te as component};
